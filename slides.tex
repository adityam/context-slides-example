\startenvironment *

\definefontfeature
  [default]
  [default]
  [compose=yes, expansion=quality, protrusion=quality]

\definefontfamily [mainface] [rm] [Fontin]
\definefontfamily [mainface] [ss] [Delicious]
\definefontfamily [mainface] [tt] [Dejavu Sans Mono] [scale=0.85, features=none]
\definefontfamily [mainface] [mm] [Neo Euler]

\setupbodyfont[mainface, 12pt]

\setupalign[hanging]
\setupwhitespace[big]

\setuppapersize [S4]

\setuplayout
    [
      cutspace=3mm,
      leftmargin=2mm,
      leftmargindistance=1mm,
      width=middle,
      rightmargindistance=1mm,
      rightmargin=2mm,
      backspace=3mm,
      %
      topspace=2mm,
      header=0mm,
      headerdistance=0mm,
      height=middle,
      footerdistance=0.2\lineheight,
      footer=0.8\lineheight,
      bottomspace=1mm,
    ]


\setupbackgrounds[page][background=color, backgroundcolor=lightgray]

\setupfooter[style=small,color=darkblue]
\setupfootertexts[\setups{footer:metadata}][\userpagenumber/\lastuserpage]

\startsetups footer:metadata
  \getvariable{metadata}{title} (\getvariable{metadata}{author})
\stopsetups

\definehead
    [slide]
    [subject]  
    [
      style=\ssbfc,
      color=darkred,
      alternative=middle,
      hidenumber=yes,
      page=yes,
    ]


\setupitemize
    [
      headstyle=\ssa,
      headcolor=darkred,
      afterhead={\blank[none]},
      inbetween={\blank[2*big]},
    ]

\startuseMPgraphic{itemize:main}
  save p; path p;
  p := fullsquare scaled 1.5ExHeight;
  fill p withcolor \MPcolor{darkred};
\stopuseMPgraphic

\startuseMPgraphic{itemize:nested}
  save p; path p;
  p := ( (0,-0.5)--(0,0.5)--(0.866,0)--cycle ) scaled ExHeight;
  fill p withcolor \MPcolor{darkred};
\stopuseMPgraphic

\definesymbol[itemize:main][\useMPgraphic{itemize:main}]
\definesymbol[itemize:nested][\useMPgraphic{itemize:nested}]

\setupitemize[1][symbol=itemize:main]
\setupitemize[2][symbol=itemize:nested, width=1.5ex]
\setupitemize[2][nowhite]

\unprotect
\c_strc_itemgroups_spacing_mode\plusone
\protect

\setvariables
    [metadata]
    [
      set={\setups{titlepage}},
    ]

\definestyle[titlestyle]   [style=\ssbfd, color=darkred]
\definestyle[authorstyle]  [style=\ssb,   color=darkblue]
\definestyle[datestyle]    [style=\tf,    color=]
\definestyle[locationstyle][style=\tf,    color=]

\startsetups titlepage
  \startstandardmakeup[align=middle]
    \titlestyle{\getvariable{metadata}{title}}
    \blank[2*big]

    \authorstyle{\getvariable{metadata}{author}}
    \blank[big]

    \locationstyle{\getvariable{metadata}{location}}
    \blank[none]
    \datestyle{\getvariable{metadata}{date}}
  \stopstandardmakeup
\stopsetups

\stopenvironment
